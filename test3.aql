use location 'eastus';

create resource group 'dmk1';

use resource group 'dmk1';

create storage account 'dmk1storage'
(
	sku = 'Standard_LRS'	
);

use storage account 'dmk1storage';

create storage share 'locust';

execute storage action 'upload file' 
(
	share = 'locust',
	source = './locust-scripts/simulator-eg.py',
	account-name = 'dmk1storage'
);

create eventgrid topic 'dmk1topic';

create eventhubs namespace 'dmk1eventhubs' 
(
	sku = 'Standard',
	capacity = 8
);

create eventhubs eventhub 'dmk1eventhub' 
(
	namespace = 'dmk1eventhubs',
	message-retention = 1,
	partition-count = 32,	
	capacity = 8
);

create eventhubs consumer-group 'dmk1cg'
(
	namespace = 'dmk1eventhubs',
	eventhub = 'dmk1eventhub'
);